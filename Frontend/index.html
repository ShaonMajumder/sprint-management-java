<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>API Example</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		function getFormData($form){
			var unindexed_array = $form.serializeArray();
			var indexed_array = {};

			$.map(unindexed_array, function(n, i){
				indexed_array[n['name']] = n['value'];
			});

			return indexed_array;
		}

		$(document).ready(function(){
			$("#getAllBtn").click(function(){
                $.ajax({
					url: 'http://localhost:8002/api/users',
					type: 'GET',
					dataType: 'json',
					crossDomain: true,
					xhrFields: {
						withCredentials: false
					},
					success: function(data) {
						$('#userTable tbody').html('');
						// console.log(data);
						$.each(data, function(index, user) {
						// do something with the user object
							console.log(user.id);
							console.log(user.username);
							console.log(user.email);
							$('#userTable tbody').append('<tr><td>' + user.id + '</td><td>' + user.username + '</td><td>' + user.password + '</td><td>' + user.firstName + '</td><td>' + user.lastName + '</td><td>' + user.email + '</td></tr>');
						// etc.
						});
					},
					error: function(xhr, status, error) {
						console.error(xhr.responseText);
					}
				});
			});
		
			$('#createUserForm').submit(function(event) {
				event.preventDefault();

				var form = $(this);
				var url = form.attr('action');
				var data = JSON.stringify(getFormData(form));

				$.ajax({
					url: 'http://localhost:8002/api/users',
					type: 'POST',
					contentType: 'application/json',
					data: data,
					dataType: 'json',
					crossDomain: true,
					xhrFields: {
						withCredentials: false
					},
					success: function(response) {
						alert("User created successfully");
						console.log(response);
					},
					error: function(xhr, textStatus, errorThrown) {
						alert("Error creating user");
						console.log(xhr.responseText);
					}
				});
			});
		});
	</script>
</head>
<body>
	<div class="container">
		<h1>Spring Management API - Users</h1>
        <hr>
        <h2>Get All Users</h2>
        <button id="getAllBtn" class="btn btn-primary">Get All Users</button>
        <br><br>
        <table id="userTable" class="table table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Password</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>


		<h2>Create User</h2>
		<form id="createUserForm" method="POST" action="/api/users">
			<div class="row">
				<div class="col-md-6">
				<div class="form-group">
					<label for="emailInput">Email</label>
					<input type="email" class="form-control" id="emailInput" name="email" placeholder="Enter email" required>
				</div>
				
				
				<div class="form-group">
					<label for="firstNameInput">First Name</label>
					<input type="text" class="form-control" id="firstNameInput" name="firstName" placeholder="Enter first name" required>
				</div>

				<div class="form-group">
					<label for="passwordInput">Password</label>
					<input type="password" class="form-control" id="passwordInput" name="password" placeholder="Enter password" required>
				</div>
				
				</div>
				<div class="col-md-6">
				
				<div class="form-group">
					<label for="usernameInput">Username</label>
					<input type="text" class="form-control" id="usernameInput" name="username" placeholder="Enter username" required>
				</div>
				
				<div class="form-group">
					<label for="lastNameInput">Last Name</label>
					<input type="text" class="form-control" id="lastNameInput" name="lastName" placeholder="Enter last name" required>
				</div>
				</div>
			</div>
			<button type="submit" class="btn btn-primary">Create User</button>
		</form>
			  

	</div>
</body>
</html>
